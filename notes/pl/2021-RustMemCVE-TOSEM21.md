# Memory-Safety Challenge Considered Solved? An In-Depth Study with All Rust CVEs

Hui Xu\*, Zhuangbin Chen\+, Mingshen Sun\-, Yangfan Zhou\*, Michael R. Lyu\+

\*Fudan, \+CHUHK, \-Baidu Security

### Category and Keywords
**Rust**, **memory safety**

## What problem does this paper survey?

### Questions asked by this paper
#### 1. *How effective is Rust in preventing memory-safety bugs?*

#### 2. *What are the characteristics of memory-safety bugs in Rust?*

##### Culprits
###### Automatic Memory Reclaim Related
(Section 5.1)
- *Bad Drop at Normal Execution Block*:
    - If a raw pointer in an unsafe block is used to construct something that
    survives the block, after the block UAF or double free may happen because
    the compiler does not consider raw pointers when doing lifetime and
    ownership inferences.
    - If a raw pointer of a `struct` is turned into a reference, the `struct`
    may drop memory that it does not own.
    - Freeing uninitialized memory (invalid free).
- *Bad Drop at Cleanup Block*. When a program panics and **stack unwinding** is
  happening, the cleanup routine may drop dangling or invalid pointers.

###### Unsound functions
(Section 5.2)
- *Bad Function Signatures*:
    - Falsely declaring an unsafe function as safe
    - interior mutability (e.g., by FFI)
    - Lack of or incorrect lifetime bound
- *Unsoundness of FFI*: There may be undefined behaviors in a called foreign
  function. There are also memory alignment data layout issues, e.g., unsafe
  Rust code assuming a certain data layout of a `struct` in a lib which might
  be changed without the awareness of the Rust developers.

###### Unsound Generic and Trait
(Section 5.3)
- *Insufficient Bound of Generic*. Most are due to lack of `Send/Sync` bound.
- *Unsound Trait*. Derived or reimplemented safe trait may be incorrect. For
  example: [incorrectly reimplemented `Error::type_id`](https://blog.rust-lang.org/2019/05/13/Security-advisory.html).


#### 3. *What lessons can we learn in order to make Rust more secure?*

### What are the strengths of this paper?
- Analysis on real-world Rust memory safety bugs.

### What are the limitations and weaknesses of this paper?

### What makes this paper publishable?

### What are other solutions and what are the most relevant works?

#### Related links

### Thing(s) that I like particularly about this paper.

### What is the take-away message from this paper?

### Other comments
